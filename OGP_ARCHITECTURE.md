# OGPメタデータ取得のアーキテクチャについて

現在のシステムでは、OGP（Open Graph Protocol）およびメタデータの取得はサーバーサイド（`/api/ogp`）で実行されています。
この構成を採用している技術的な理由と、クライアントサイド（ブラウザ）のみでの実行が困難な理由を以下にまとめます。

## 1. CORS（Cross-Origin Resource Sharing）の制限
ブラウザのセキュリティポリシーにより、JavaScriptから異なるドメイン（例: 外部のニュースサイトやブログ）に対して直接 `fetch` や `axios` でリクエストを送信することは、接続先のサーバーが許可していない限りブロックされます。
ほとんどのWebサイトはCORSヘッダー（`Access-Control-Allow-Origin: *`）を設定していないため、クライアントサイドから直接HTMLを取得することはできません。
これを回避するためには、自前のサーバーをプロキシ（中継）として利用し、サーバーからリクエストを行う必要があります。

## 2. 文字コード（エンコーディング）の処理
Webサイトによっては、UTF-8ではなく `Shift_JIS` や `EUC-JP` などの文字コードが使用されている場合があります。
現在のサーバーサイド実装では、`iconv-lite` ライブラリを使用してレスポンスの `Content-Type` ヘッダーなどから文字コードを判別し、適切にデコード処理を行っています。
ブラウザ環境でこれらを汎用的に処理しようとすると、外部ライブラリの導入によりアプリケーションのファイルサイズ（バンドルサイズ）が増大する可能性があります。

## 3. User-Agentの設定
一部のWebサイトは、Botやスクレイピングを防止するために、User-Agent（ブラウザの種類を示す情報）をチェックしています。
サーバーサイドでは適切な User-Agent ヘッダーを設定してリクエストを行うことで、実際のブラウザに近い挙動を模倣し、取得の成功率を高めています。

## 結論
以上の理由から、現在の「クライアントから自社サーバーのAPIを呼び出し、サーバーが外部サイトへアクセスする」という構成が最も安定かつ標準的なアプローチです。
クライアントサイドのみで完結させる（サーバー処理をなくす）場合、外部のCORS対応プロキシサービスやAPIサービスを利用する必要がありますが、セキュリティや安定性の観点から、現在の構成の維持が推奨されます。
